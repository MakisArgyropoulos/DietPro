import streamlit as st
import pandas as pd
import plotly.express as px
import datetime
import gspread
from oauth2client.service_account import ServiceAccountCredentials
import io

# --- Î¡Î¥Î˜ÎœÎ™Î£Î•Î™Î£ GOOGLE SHEETS ---
SHEET_URL = "https://docs.google.com/spreadsheets/d/14w_r_xHdVkekACZ7EK-G8HeAA2-jG4x2arPdYoxMNvQ/edit?gid=0#gid=0"  # Î’Î¬Î»Îµ Ï„Î¿ link Ï„Î¿Ï… Sheet ÏƒÎ¿Ï…
SERVICE_ACCOUNT_FILE = "service_account.json"  # Î¤Î¿ JSON Ï€Î¿Ï… ÎºÎ±Ï„Î­Î²Î±ÏƒÎµÏ‚ Î±Ï€ÏŒ Google Cloud

import json

scope = ["https://spreadsheets.google.com/feeds", "https://www.googleapis.com/auth/drive"]

if "gcp_service_account" in st.secrets:
    creds_dict = st.secrets["gcp_service_account"]
    creds = ServiceAccountCredentials.from_json_keyfile_dict(dict(creds_dict), scope)
else:
    creds = ServiceAccountCredentials.from_json_keyfile_name("service_account.json", scope)

client = gspread.authorize(creds)
sheet = client.open_by_url(SHEET_URL).sheet1


import pandas as pd

# --- Î”ÎµÎ´Î¿Î¼Î­Î½Î± ---
data = {
    "ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±": [
        "Î£Î½Î±Îº","Î£Î½Î±Îº","Î£Î½Î±Îº","Î£Î½Î±Îº","Î£Î½Î±Îº","Î£Î½Î±Îº","Î£Î½Î±Îº","Î£Î½Î±Îº","Î£Î½Î±Îº",
        "Î ÏÏ‰Î¹Î½ÏŒ","Î ÏÏ‰Î¹Î½ÏŒ","Î ÏÏ‰Î¹Î½ÏŒ","Î ÏÏ‰Î¹Î½ÏŒ","Î ÏÏ‰Î¹Î½ÏŒ","Î ÏÏ‰Î¹Î½ÏŒ","Î ÏÏ‰Î¹Î½ÏŒ",
        "ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±",
        "ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±",
        "ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±","ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±",
        "Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±",
        "Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±",
        "Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±","Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±"
    ],
    "Î•Ï€Î¹Î»Î¿Î³Î®": [
        "Î¤Î¯Ï€Î¿Ï„Î±",
        "1-2 Î¦ÏÎ¿ÏÏ„Î±",
        "1 Î¦ÏÎ¿ÏÏ„Î¿ Î¼Îµ 1 Ï‡Î¿ÏÏ†Ï„Î± Î±Î¼ÏÎ³Î´Î±Î»Î±",
        "2-3 Î´Î±Î¼Î¬ÏƒÎºÎ·Î½Î± ÎºÎ±Î¹ 12 Î±Î¼ÏÎ³Î´Î±Î»Î±",
        "Î“Î¹Î±Î¿ÏÏÏ„Î¹ 2% Î¼Îµ 1 Îº.Î³. Î¼Î­Î»Î¹",
        "2 Ï†ÏÏ…Î³Î±Î½Î¹Î­Ï‚/ÎºÏÎ¬ÎºÎµÏ Î¼Îµ 2 Ï†Î­Ï„ÎµÏ‚ Ï„Ï…ÏÎ¯",
        "2 Ï†ÏÏ…Î³Î±Î½Î¹Î­Ï‚/ÎºÏÎ¬ÎºÎµÏ Î¼Îµ 100 Î³Ï. cottage cheese",
        "Smoothie Î¼Îµ 1 ÎºÎ¿ÏÏ€Î± Î³Î¬Î»Î± ÎºÎ±Î¹ 1/2 Î¼Ï€Î±Î½Î¬Î½Î±",
        "1 Î¼Ï€Î¬Î»Î± Ï€Î±Î³Ï‰Ï„ÏŒ",
        "Î¤Î¯Ï€Î¿Ï„Î±",
        "ÎœÎ¹ÎºÏÎ® Î±ÏÎ±Î²Î¹ÎºÎ® Î¼Îµ 2 Ï†Î­Ï„ÎµÏ‚ Ï„Ï…ÏÎ¯ light",
        "ÎœÎ¹ÎºÏÎ® Î±ÏÎ±Î²Î¹ÎºÎ® Î¼Îµ 1 Î±Ï…Î³ÏŒ ÎºÎ±Î¹ 1 Ï†Î­Ï„Î± Ï„Ï…ÏÎ¯",
        "Î¨Ï‰Î¼Î¯ Î¼Îµ 2 Îº.Ïƒ. cottage cheese, 1 Î±Ï…Î³ÏŒ ÎºÎ±Î¹ 1/4 Î±Î²Î¿ÎºÎ¬Î½Ï„Î¿",
        "ÎšÎ¿Ï…Î»Î¿ÏÏÎ¹ Î˜ÎµÏƒÏƒÎ±Î»Î¿Î½Î¯ÎºÎ·Ï‚ Î¼Îµ Î³Î¹Î±Î¿ÏÏÏ„Î¹ 2%",
        "Î“Î¹Î±Î¿ÏÏÏ„Î¹ 2% Î¼Îµ 2 Îº.Ïƒ. Î²ÏÏÎ¼Î·, 1 Îº.Î³. Î¼Î­Î»Î¹, 1 Ï†ÏÎ¿ÏÏ„Î¿ ÎºÎ±Î¹ 2-3 ÎºÎ±ÏÏÎ´Î¹Î±",
        "2 Ï†ÏÏ…Î³Î±Î½Î¹Î­Ï‚ Î¼Îµ 100 Î³Ï.cottage cheese, 1 Îº.Î³.Î¼Î±ÏÎ¼ÎµÎ»Î¬Î´Î±",
        "Î¤Î¯Ï€Î¿Ï„Î±",
        "ÎŒÏƒÏ€ÏÎ¹Î± (1,5 Ï†Î»Î¹Ï„Î¶.), 50 Î³Ï. Î±Î½Î¸ÏŒÏ„Ï…ÏÎ¿, 2 Ï€Î±Î¾Î¹Î¼Î±Î´Î¬ÎºÎ¹Î± ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î£Î±Î»Î¬Ï„Î± Î¼Îµ 1 Ï†Î»Î¹Ï„Î¶. ÏŒÏƒÏ€ÏÎ¹Î¿, 100 Î³Ï. Ï„ÏŒÎ½Î¿, 2 Ï€Î±Î¾Î¹Î¼Î±Î´Î¬ÎºÎ¹Î± ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î¨Î¬ÏÎ¹ (180 Î³Ï.) Î¼Îµ 1 Ï€Î±Ï„Î¬Ï„Î± Î²ÏÎ±ÏƒÏ„Î® ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "ÎœÏ€Î¹Ï†Ï„Î­ÎºÎ¹Î± (200 Î³Ï.) Î® ÎœÏ€Î¹Ï†Ï„Î­ÎºÎ¹Î± ÎºÎ¿Ï„ÏŒÏ€Î¿Ï…Î»Î¿ (250 Î³Ï.) ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î¨Î±ÏÎ¿Î½Î­Ï†ÏÎ¹ (180 Î³Ï.) ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "ÎœÎ¿ÏƒÏ‡Î¬ÏÎ¹ (120 Î³Ï.) Î¼Îµ ÏÏÎ¶Î¹ (1 Ï†Î»Î¹Ï„Î¶.) ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î›Î±Î´ÎµÏÏŒ (1,5 Ï†Î»Î¹Ï„Î¶.) Î¼Îµ Ï„Ï…ÏÎ¯ (60 Î³Ï.) ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "ÎšÎ¿Ï„ÏŒÏ€Î¿Ï…Î»Î¿ (150 Î³Ï.) Î¼Îµ Ï€Î±Ï„Î¬Ï„ÎµÏ‚/ÏÏÎ¶Î¹ (1 Ï†Î»Î¹Ï„Î¶.) ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "ÎœÎ±ÎºÎ±ÏÏŒÎ½Î¹Î± (1,5 Ï†Î»Î¹Ï„Î¶.) Î¼Îµ ÎºÎ¹Î¼Î¬ (6 Îº.Ïƒ.) ÎºÎ±Î¹ Ï„Ï…ÏÎ¯ (1 Îº.Ïƒ.) ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "ÎœÎ±ÎºÎ±ÏÏŒÎ½Î¹Î± (1 Ï†Î»Î¹Ï„Î¶.), Î³Î±ÏÎ¯Î´ÎµÏ‚ (150 Î³Ï.) ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î“ÎµÎ¼Î¹ÏƒÏ„Î¬ (2), Ï„Ï…ÏÎ¯ (60 Î³Ï.) ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î£Î±Î»Î¬Ï„Î± Î¼Îµ 2 Î±Ï…Î³Î¬, 50 Î³Ï. cottage cheese ÎºÎ±Î¹ 2 Ï€Î±Ï„Î¬Ï„ÎµÏ‚ Î²ÏÎ±ÏƒÏ„Î­Ï‚ ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "ÎŸÎ¼ÎµÎ»Î­Ï„Î± Î¼Îµ 2 Î±Ï…Î³Î¬, 30 Î³Ï. Ï„Ï…ÏÎ¯ Î»Î±Ï‡Î±Î½Î¹ÎºÎ¬ ÎºÎ±Î¹ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿ ÎºÎ±Î¹ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î¤Î¯Ï€Î¿Ï„Î±",
        "1 Î³Î¹Î±Î¿ÏÏÏ„Î¹ 2% Î¼Îµ 2 Îº.Ïƒ. Î²ÏÏÎ¼Î·, 1 Ï†ÏÎ¿ÏÏ„Î¿ ÎºÎ±Î¹ 1 Ï‡Î¿ÏÏ†Ï„Î± Î¾Î·ÏÎ¿ÏÏ‚ ÎºÎ±ÏÏ€Î¿ÏÏ‚",
        "Î‘ÏÎ±Î²Î¹ÎºÎ® Î¼Îµ 120 Î³Ï. ÎºÎ¿Ï„ÏŒÏ€Î¿Ï…Î»Î¿, Î»Î±Ï‡Î±Î½Î¹ÎºÎ¬ ÎºÎ±Î¹ 1 Îº.Ïƒ. Î³Î¹Î±Î¿ÏÏÏ„Î¹",
        "Î£Î±Î»Î¬Ï„Î± Î§Ï‰ÏÎ¹Î¬Ï„Î¹ÎºÎ·/ÎÏ„Î¬ÎºÎ¿Ï‚ Î¼Îµ 100 Î³Ï. ÎºÎ±Ï„Î¯ÎºÎ¹, 2 Ï€Î±Î¾Î¹Î¼Î¬Î´Î¬ÎºÎ¹Î± ÎºÎ±Î¹ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "ÎšÎ¿Ï„Î¿Î¼Ï€Î¿Ï…ÎºÎ¹Î­Ï‚ (150Î³Ï.) Î¼Îµ ÏƒÎ±Î»Î¬Ï„Î± ÎºÎ±Î¹ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "ÎœÏ€Î¹Ï†Ï„Î­ÎºÎ¹Î± (120 Î³Ï.) Î® ÎœÏ€Î¹Ï†Ï„Î­ÎºÎ¹Î± ÎºÎ¿Ï„ÏŒÏ€Î¿Ï…Î»Î¿ (150 Î³Ï.) Î¼Îµ ÏƒÎ±Î»Î¬Ï„Î± ÎºÎ±Î¹ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î£Î±Î»Î¬Ï„Î± Î¼Îµ 120 Î³Ï. ÎºÎ¿Ï„ÏŒÏ€Î¿Ï…Î»Î¿, 2 Îº.Ïƒ. ÎºÎ±Î»Î±Î¼Ï€ÏŒÎºÎ¹ ÎºÎ±Î¹ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î£Î±Î»Î¬Ï„Î± Î¼Îµ 2 Î±Ï…Î³Î¬, 1 Ï€Î±Ï„Î¬Ï„Î± Î²ÏÎ±ÏƒÏ„Î®, 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î¨Î·Ï„Î¬ Î»Î±Ï‡Î±Î½Î¹ÎºÎ¬ ÎºÎ±Î¹ Î¼Î±Î½Î¹Ï„Î¬ÏÎ¹Î±, 200 Î³Ï. ÎºÎ±Ï„Î¯ÎºÎ¹, 1 Ï†Î­Ï„Î± ÏˆÏ‰Î¼Î¯",
        "Î£Î±Î»Î¬Ï„Î± Î¼Îµ 100 Î³Ï. Ï„ÏŒÎ½Î¿, 2 Îº.Ïƒ. ÎºÏÎ¿Ï…Ï„ÏŒÎ½ ÎºÎ±Î¹ 1/4 Î±Î²Î¿ÎºÎ¬Î½Ï„Î¿",
        "ÎŸÎ¼ÎµÎ»Î­Ï„Î± Î¼Îµ 2 Î±Ï…Î³Î¬, 2 Î±ÏƒÏ€ÏÎ¬Î´Î¹Î±, 30 Î³Ï. Ï„Ï…ÏÎ¯, Î»Î±Ï‡Î±Î½Î¹ÎºÎ¬ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿ ÎºÎ±Î¹ 1 Ï†Î­Ï„Î± ÏˆÏ‰Î¼Î¯",
        "Î Î¯Ï„ÏƒÎ± Î¼Îµ 1 Ï„Î¿ÏÏ„Î¯Î³Î¹Î± Î¼Îµ 2 Ï†Î­Ï„ÎµÏ‚ Ï„Ï…ÏÎ¯, Î»Î±Ï‡Î±Î½Î¹ÎºÎ¬ ÎºÎ±Î¹ ÏƒÎ¬Î»Ï„ÏƒÎ± Î½Ï„Î¿Î¼Î¬Ï„Î±Ï‚",
        "3 ÎºÎ±Î»Î±Î¼Î¬ÎºÎ¹Î± ÎºÎ¿Ï„ÏŒÏ€Î¿Ï…Î»Î¿ Î¼Îµ ÏƒÎ±Î»Î¬Ï„Î± Î¼Îµ 2 Îº.Î³. ÎµÎ»Î±Î¹ÏŒÎ»Î±Î´Î¿",
        "Î£Î¿Ï…Î²Î»Î¬ÎºÎ¹ Î¼Îµ Î±Î»Î¬Î´Ï‰Ï„Î· Ï€Î¯Ï„Î±, ÎºÎ±Î»Î±Î¼Î¬ÎºÎ¹ ÎºÎ¿Ï„ÏŒÏ€Î¿Ï…Î»Î¿, Ï‡Ï‰ÏÎ¯Ï‚ Ï€Î±Ï„Î¬Ï„ÎµÏ‚"
    ],
    # Î•ÎºÏ„Î¹Î¼Î®ÏƒÎµÎ¹Ï‚ Î¸ÎµÏÎ¼Î¯Î´Ï‰Î½ & macros
    "Î˜ÎµÏÎ¼Î¯Î´ÎµÏ‚ (kcal)": [0,80,220,230,150,240,210,170,200,0,250,300,320,360,340,250,520,500,560,540,470,520,680,520,480,500,470,520,500,520,500,470,570,520],
    "Î ÏÏ‰Ï„ÎµÎÎ½Î· (g)": [0,1,6,6,9,14,12,9,3,0,14,16,18,14,16,14,24,36,42,34,22,38,30,22,20,18,30,22,28,27,30,27,28,32],
    "Î¥Î´Î±Ï„Î¬Î½Î¸ÏÎ±ÎºÎµÏ‚ (g)": [0,20,17,22,17,22,20,15,24,0,30,28,30,48,42,28,52,38,22,42,38,38,74,38,14,40,42,38,22,22,27,20,30,32],
    "Î›Î¯Ï€Î¿Ï‚ (g)": [0,0,13,11,5,8,6,6,8,0,6,9,11,9,9,8,16,12,21,16,15,13,22,12,29,18,13,19,16,19,16,21,21,16],
    "Î¦Ï…Ï„Î¹ÎºÎ­Ï‚ Î¯Î½ÎµÏ‚ (g)": [0,3,4,5,0,2,1,1,0,0,3,3,4,5,6,4,9,3,2,4,9,4,7,6,5,4,5,7,4,4,5,6,7,4],
    "ÎšÎ¿ÏÎµÏƒÎ¼Î­Î½Î± (g)": [0,0,1.5,1.3,3,4,3,3,5,0,3,4,5,4,4,3,6,4,5,4,4,4,8,4,10,5,5,7,5,7,5,8,8,6]
}

df = pd.DataFrame(data)



st.set_page_config(page_title="DietPro", page_icon="ğŸ¥—", layout="centered")
st.title("DietPro â€“ Î—Î¼ÎµÏÎ®ÏƒÎ¹Î¿Ï‚ Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Î˜ÎµÏÎ¼Î¯Î´Ï‰Î½ & ÎœÎ±ÎºÏÎ¿Î¸ÏÎµÏ€Ï„Î¹ÎºÏÎ½")
st.write("Î•Ï€Î¯Î»ÎµÎ¾Îµ 3 ÏƒÎ½Î±Îº ÎºÎ±Î¹ 3 Î³ÎµÏÎ¼Î±Ï„Î±. ÎœÏ€Î¿ÏÎµÎ¯Ï‚ Î½Î± Î±Ï€Î¿Î¸Î·ÎºÎµÏÏƒÎµÎ¹Ï‚ Ï„Î·Î½ Î·Î¼Î­ÏÎ± ÏƒÎ¿Ï… ÎºÎ±Î¹ Î½Î± ÎºÎ±Ï„ÎµÎ²Î¬ÏƒÎµÎ¹Ï‚ Ï„Î¿ Î¹ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ.")

# --- Î•Ï€Î¹Î»Î¿Î³Î­Ï‚ Î±Î½Î¬ ÎºÎ±Ï„Î·Î³Î¿ÏÎ¯Î± ---
breakfast_options = df[df["ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±"] == "Î ÏÏ‰Î¹Î½ÏŒ"]["Î•Ï€Î¹Î»Î¿Î³Î®"].tolist()
snack_options = df[df["ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±"] == "Î£Î½Î±Îº"]["Î•Ï€Î¹Î»Î¿Î³Î®"].tolist()
main_meal_options = df[df["ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±"] == "ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±"]["Î•Ï€Î¹Î»Î¿Î³Î®"].tolist()
second_meal_options = df[df["ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±"] == "Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±"]["Î•Ï€Î¹Î»Î¿Î³Î®"].tolist()

# --- Î•Ï€Î¹Î»Î¿Î³Î­Ï‚ Î¼Îµ ÏƒÎµÎ¹ÏÎ¬ ---
breakfast = st.selectbox("Î ÏÏ‰Î¹Î½ÏŒ", breakfast_options, key="breakfast")
snack1 = st.selectbox("Î£Î½Î±Îº 1", snack_options, key="snack1")
main_meal = st.selectbox("ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±", main_meal_options, key="main_meal")
snack2 = st.selectbox("Î£Î½Î±Îº 2", snack_options, key="snack2")
second_meal = st.selectbox("Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±", second_meal_options, key="second_meal")
snack3 = st.selectbox("Î£Î½Î±Îº 3", snack_options, key="snack3")

# --- Î£Ï„Î±Î¸ÎµÏÎ® ÏƒÎµÎ¹ÏÎ¬ ÎµÏ€Î¹Î»Î¿Î³ÏÎ½ ---
choices = {
    "Î ÏÏ‰Î¹Î½ÏŒ": breakfast,
    "Î£Î½Î±Îº 1": snack1,
    "ÎšÏ…ÏÎ¯Ï‰Ï‚ Î“ÎµÏÎ¼Î±": main_meal,
    "Î£Î½Î±Îº 2": snack2,
    "Î”ÎµÏÏ„ÎµÏÎ¿ Î“ÎµÏÎ¼Î±": second_meal,
    "Î£Î½Î±Îº 3": snack3
}

rows = []
total_cal = total_prot = total_carb = total_fat = total_fiber = 0

for category, item in choices.items():
    row = df[df["Î•Ï€Î¹Î»Î¿Î³Î®"] == item]
    if not row.empty:
        cal = row["Î˜ÎµÏÎ¼Î¯Î´ÎµÏ‚ (kcal)"].values[0]
        prot = row["Î ÏÏ‰Ï„ÎµÎÎ½Î· (g)"].values[0]
        carb = row["Î¥Î´Î±Ï„Î¬Î½Î¸ÏÎ±ÎºÎµÏ‚ (g)"].values[0]
        fat = row["Î›Î¯Ï€Î¿Ï‚ (g)"].values[0]
        fiber = row["Î¦Ï…Ï„Î¹ÎºÎ­Ï‚ Î¯Î½ÎµÏ‚ (g)"].values[0]
        sat_fat = row["ÎšÎ¿ÏÎµÏƒÎ¼Î­Î½Î± (g)"].values[0]
    else:
        cal = prot = carb = fat = fiber = 0

    rows.append({
        "ÎšÎ±Ï„Î·Î³Î¿ÏÎ¯Î±": category,
        "Î•Ï€Î¹Î»Î¿Î³Î®": item,
        "Î˜ÎµÏÎ¼Î¯Î´ÎµÏ‚ (kcal)": cal,
        "Î ÏÏ‰Ï„ÎµÎÎ½Î· (g)": prot,
        "Î¥Î´Î±Ï„Î¬Î½Î¸ÏÎ±ÎºÎµÏ‚ (g)": carb,
        "Î›Î¯Ï€Î¿Ï‚ (g)": fat,
        "Î¦Ï…Ï„Î¹ÎºÎ­Ï‚ Î¯Î½ÎµÏ‚ (g)": fiber,
        "ÎšÎ¿ÏÎµÏƒÎ¼Î­Î½Î± (g)": sat_fat
    })

    total_cal += cal
    total_prot += prot
    total_carb += carb
    total_fat += fat
    total_fiber += fiber

# DataFrame Î³Î¹Î± ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ·
selected_df = pd.DataFrame(rows)





# --- Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼Î¿Î¯ ---
total_cal = selected_df["Î˜ÎµÏÎ¼Î¯Î´ÎµÏ‚ (kcal)"].sum()
total_prot = selected_df["Î ÏÏ‰Ï„ÎµÎÎ½Î· (g)"].sum()
total_carb = selected_df["Î¥Î´Î±Ï„Î¬Î½Î¸ÏÎ±ÎºÎµÏ‚ (g)"].sum()
total_fat = selected_df["Î›Î¯Ï€Î¿Ï‚ (g)"].sum()
total_fiber = selected_df["Î¦Ï…Ï„Î¹ÎºÎ­Ï‚ Î¯Î½ÎµÏ‚ (g)"].sum()
total_sat_fat = selected_df["ÎšÎ¿ÏÎµÏƒÎ¼Î­Î½Î± (g)"].sum()

st.subheader("Î£ÏÎ½Î¿Î»Î¿:")
st.write(f"**Î˜ÎµÏÎ¼Î¯Î´ÎµÏ‚:** {total_cal} kcal")
st.write(f"**Î ÏÏ‰Ï„ÎµÎÎ½Î·:** {total_prot} g | **Î¥Î´Î±Ï„Î¬Î½Î¸ÏÎ±ÎºÎµÏ‚:** {total_carb} g | **Î›Î¯Ï€Î¿Ï‚:** {total_fat} g | **Î¦Ï…Ï„Î¹ÎºÎ­Ï‚ Î¯Î½ÎµÏ‚:** {total_fiber} g | **ÎšÎ¿ÏÎµÏƒÎ¼Î­Î½Î±:** {total_sat_fat} g")

# --- Î£Ï„ÏŒÏ‡Î¿Î¹ ---
prot_target = 150
carb_target = 200
fat_target = 70
fiber_target = 25
sat_fat_target = 20

# --- Progress Î³Î¹Î± ÎºÎ¬Î¸Îµ Î¼Î±ÎºÏÎ¿Î¸ÏÎµÏ€Ï„Î¹ÎºÏŒ ---
st.subheader("ÎšÎ¬Î»Ï…ÏˆÎ· Î£Ï„ÏŒÏ‡Ï‰Î½ ÎœÎ±ÎºÏÎ¿Î¸ÏÎµÏ€Ï„Î¹ÎºÏÎ½:")
st.write(f"Î ÏÏ‰Ï„ÎµÎÎ½Î·: {total_prot}g / {prot_target}g")
st.progress(min(total_prot / prot_target, 1.0))

st.write(f"Î¥Î´Î±Ï„Î¬Î½Î¸ÏÎ±ÎºÎµÏ‚: {total_carb}g / {carb_target}g")
st.progress(min(total_carb / carb_target, 1.0))

st.write(f"Î›Î¯Ï€Î¿Ï‚: {total_fat}g / {fat_target}g")
st.progress(min(total_fat / fat_target, 1.0))

st.write(f"Î¦Ï…Ï„Î¹ÎºÎ­Ï‚ Î¯Î½ÎµÏ‚: {total_fiber}g / {fiber_target}g")
st.progress(min(total_fiber / fiber_target, 1.0))

st.write(f"ÎšÎ¿ÏÎµÏƒÎ¼Î­Î½Î±: {total_sat_fat}g / {sat_fat_target}g")
st.progress(min(total_sat_fat / sat_fat_target, 1.0))




# --- Î”Î¹Î¬Î³ÏÎ±Î¼Î¼Î± Î Î¯Ï„Î±Ï‚ ---
if total_cal > 0:
    macros = {"Î ÏÏ‰Ï„ÎµÎÎ½Î·": total_prot, "Î¥Î´Î±Ï„Î¬Î½Î¸ÏÎ±ÎºÎµÏ‚": total_carb, "Î›Î¯Ï€Î¿Ï‚": total_fat}
    fig = px.pie(values=macros.values(), names=macros.keys(), title="ÎšÎ±Ï„Î±Î½Î¿Î¼Î® ÎœÎ±ÎºÏÎ¿Î¸ÏÎµÏ€Ï„Î¹ÎºÏÎ½")
    st.plotly_chart(fig)

st.write("Î‘Î½Î±Î»Ï…Ï„Î¹ÎºÎ¬:")
st.dataframe(selected_df)
# --- Î¥Ï€Î¿Î»Î¿Î³Î¹ÏƒÎ¼ÏŒÏ‚ Ï€Î¿ÏƒÎ¿ÏƒÏ„ÏÎ½ ÎºÎ¬Î»Ï…ÏˆÎ·Ï‚ ---
prot_target = 150
carb_target = 200
fat_target = 70
fiber_target = 25

prot_pct = round((total_prot / prot_target) * 100, 1)
carb_pct = round((total_carb / carb_target) * 100, 1)
fat_pct = round((total_fat / fat_target) * 100, 1)
fiber_pct = round((total_fiber / fiber_target) * 100, 1)

# --- Î•Ï€Î¹Î»Î¿Î³Î® Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±Ï‚ ---
selected_date = st.date_input("Î—Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î± ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ·Ï‚", value=datetime.date.today())

# --- Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î—Î¼Î­ÏÎ±Ï‚ ÏƒÏ„Î¿ Google Sheet ---
if st.button("Î‘Ï€Î¿Î¸Î®ÎºÎµÏ…ÏƒÎ· Î—Î¼Î­ÏÎ±Ï‚"):
    # ÎÎ­Î± Î³ÏÎ±Î¼Î¼Î® Î¼Îµ ÏƒÏ‰ÏƒÏ„Î¿ÏÏ‚ Ï„ÏÏ€Î¿Ï…Ï‚
    new_row = [
        str(selected_date),
        str(breakfast),
        str(snack1),
        str(main_meal),
        str(snack2),
        str(second_meal),
        str(snack3),
        int(total_cal),
        float(total_prot),
        float(prot_pct),
        float(total_carb),
        float(carb_pct),
        float(total_fat),
        float(fat_pct),
        float(total_fiber),
        float(fiber_pct)
    ]

    # Î¦Î­ÏÎµ ÏŒÎ»Î± Ï„Î± Î´ÎµÎ´Î¿Î¼Î­Î½Î±
    all_rows = sheet.get_all_values()
    headers = all_rows[0]
    data = all_rows[1:]

    # Î”Î¹Î­Î³ÏÎ±ÏˆÎµ ÏŒÎ»ÎµÏ‚ Ï„Î¹Ï‚ Î³ÏÎ±Î¼Î¼Î­Ï‚ Ï€Î¿Ï… Î­Ï‡Î¿Ï…Î½ Î®Î´Î· Î±Ï…Ï„Î® Ï„Î·Î½ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±
    indices_to_delete = [i+2 for i, row in enumerate(data) if row and row[0] == str(selected_date)]  # +2 Î»ÏŒÎ³Ï‰ header ÎºÎ±Î¹ 1-based indexing
    for idx in sorted(indices_to_delete, reverse=True):
        sheet.delete_rows(idx)

    # Î ÏÏŒÏƒÎ¸ÎµÏƒÎµ Ï„Î· Î½Î­Î± Î³ÏÎ±Î¼Î¼Î®
    sheet.append_row(new_row)
    st.success(f"Î— ÎºÎ±Ï„Î±Ï‡ÏÏÎ·ÏƒÎ· Î³Î¹Î± {selected_date} Î±Ï€Î¿Î¸Î·ÎºÎµÏÏ„Î·ÎºÎµ (Î±Î½Ï„Î¹ÎºÎ±Ï„Î±ÏƒÏ„Î¬Î¸Î·ÎºÎµ Î· Ï€Î±Î»Î¹Î¬, Î±Î½ Ï…Ï€Î®ÏÏ‡Îµ).")





st.subheader("Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ Î—Î¼ÎµÏÏÎ½")
rows = sheet.get_all_records()
if rows:
    history_df = pd.DataFrame(rows)
    st.dataframe(history_df)

    # ÎšÎ±Ï„Î­Î²Î±ÏƒÎ¼Î± Excel
    output = io.BytesIO()
    with pd.ExcelWriter(output, engine='xlsxwriter') as writer:
        history_df.to_excel(writer, index=False, sheet_name='Î™ÏƒÏ„Î¿ÏÎ¹ÎºÏŒ')
    st.download_button(
        label="Î›Î®ÏˆÎ· Î™ÏƒÏ„Î¿ÏÎ¹ÎºÎ¿Ï ÏƒÎµ Excel",
        data=output.getvalue(),
        file_name="history.xlsx",
        mime="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"
    )
else:
    st.info("Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎºÎ±Ï„Î±Ï‡Ï‰ÏÎ®ÏƒÎµÎ¹Ï‚ Î±ÎºÏŒÎ¼Î±.")
